---
title: "Personal Dataset Project"
author: "Chris Nelson-Pyne"
format: html
editor: visual
---

```{r load_tidyverse}

library(tidyverse)
```

```{r cleaning_mbta_ridership_data}

MBTA = read.csv("./MBTA/MBTA_Monthly_Ridership_By_Mode_and_Line.csv")

head(MBTA)

MBTA_totals = MBTA %>%
  filter(daytype =="Total") %>%
  filter(route_or_line %in% c("All Bus", "Commuter Rail", "Heavy Rail"))

head (MBTA_totals)

write_excel_csv(MBTA_totals, "MBTA_Avg_Daily_Ridership_by_Month.csv")

```

```{r Processing_MBTA & Septa}
SEPTA_MBTA = read.csv("SEPTA_MBTA Average_Ridership_By_Mode.csv")

head(SEPTA_MBTA)

SEPTA_MBTA = SEPTA_MBTA %>%
  mutate (Stan_Mode = case_when (Mode == "Bus" ~ "Bus",
                                 Mode == "All Bus" ~ "Bus",
                                 Mode == "Heavy Rail" ~ "Heavy Rail",
                                 Mode == "Regional Rail" ~ "Commuter Rail",
                                 Mode == "Commuter Rail" ~ "Commuter Rail",
                                 Mode == "Trolley" ~ "Trolley",
                                 Mode == "Trackless Trolley" ~ "Trackless Trolley",
                                 Mode == "CCT" ~ "CCT",
                                 ))
head(SEPTA_MBTA)
SEPTA_MBTA2 = filter (SEPTA_MBTA, Stan_Mode == "Bus" |
                        Stan_Mode ==  "Heavy Rail" |
                        Stan_Mode == "Commuter Rail" 
                      )


Rail_and_bus = mutate (SEPTA_MBTA2, RBMode = case_when(Stan_Mode == "Bus" ~ "Bus",
                                                       Stan_Mode == "Heavy Rail" ~ "Rail",
                                                       Stan_Mode == "Commuter Rail" ~ "Rail",
  ))

Rail_and_bus2 = filter (SEPTA_MBTA, Stan_Mode == "Bus" | Stan_Mode == "Heavy Rail")
```

```{r EDA1}

ggplot (data = SEPTA_MBTA2, aes (x=Average_Daily_Ridership, y = Agency)) + geom_boxplot ()

ggplot (data = Rail_and_bus, aes (x = Average_Daily_Ridership, fill = RBMode)) + geom_boxplot ()

ggplot (data = Rail_and_bus2, aes (x = Average_Daily_Ridership, fill = Stan_Mode)) + geom_boxplot ()
```

```{r modeling}
m1 = glm (as.factor (Stan_Mode) ~ Average_Daily_Ridership, data = Rail_and_bus2, family = binomial )

summary(m1)

Rail_and_bus2$RBprobability = m1$fitted.values

Rail_and_bus2$predicted_mode = ifelse(Rail_and_bus2$RBprobability <0.5, "Bus","Heavy Rail")

mean (Rail_and_bus2$predicted_mode==Rail_and_bus2$Stan_Mode)
```
